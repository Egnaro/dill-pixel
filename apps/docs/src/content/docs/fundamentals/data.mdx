---
title: Data Management
description: Learn how to manage and persist data in your dill-pixel application
---

import { Aside, Code, TabItem, Tabs } from '@astrojs/starlight/components';

## Overview

dill pixel provides a robust data management system through its `DataAdapter` class. This system allows you to:

- Store and retrieve game data
- Persist data to localStorage
- Listen for data changes
- Selectively backup specific data keys

## Basic Configuration

Configure data management in your `dill-pixel.config.ts`:

```ts
export type Data = {
  score: number;
  playerName: string;
  settings: {
    soundEnabled: boolean;
    musicVolume: number;
  };
};
export const config = defineConfig<Data>({
  // ... other config options
  data: {
    // Initial data values
    initial: {
      score: 0,
      playerName: '',
      settings: {
        soundEnabled: true,
        musicVolume: 0.5,
      },
    },
    // Keys to backup to localStorage
    backupKeys: ['settings'],
    // Whether to backup all data (alternative to specifying keys)
    backupAll: false,
    // Optional namespace for localStorage keys
    namespace: 'my-game',
  },
});
```

## Data Manipulation Methods

The DataAdapter provides several methods for managing game data. Each has specific use cases and behaviors.

## set() Method

The `set()` method allows updating single or multiple values, with optional deep merging:

```ts
// Update a single value
this.app.data.set('score', 100);

// Update multiple values with deep merge (default)
this.app.data.set({
  score: 100,
  settings: {
    soundEnabled: false, // Only updates soundEnabled, preserves other settings
  },
});
```

<Aside title="Type Safety" type="note">
  Type safety is enforced for the `set()` method. If you pass an object that doesn't match the expected shape,
  TypeScript will throw an error.
</Aside>

```ts
this.app.data.set('score', 'pickle'); // will throw a ts error
```

### Deep Merge Behavior

You can also use the `merge` parameter to control the merge behavior. By default, the `set()` method will merge the new data with the existing data, passing `false` will replace the entire data object.

<Aside title="Merge: true (default)" type="tip">
  When using `set()` with `merge: true` (default), the DataAdapter performs a deep merge:
</Aside>
<Tabs>
<TabItem label="dill-pixel.config.ts">
<Code lang="ts" code={`
// Initial data, set in dill-pixel.config.ts
defineConfig<Data>({
    // ... other config options
    data: {
      initial: {
        settings: {
          sound: { enabled: true, volume: 0.5 },
          display: { fullscreen: false },
        },
      },
    },
  });
`}
/>
</TabItem>
<TabItem label="src/scenes/MyScene.ts">
<Code lang="ts" code={`
// Update with deep merge
  this.app.data.set({
    settings: {
      sound: { volume: 0.8 }
    }
  });

    /* Result:
    {
      settings: {
        sound: { enabled: true, volume: 0.8 },
        display: { fullscreen: false }
      }
    }
    */

`}/>

</TabItem>
</Tabs>
<Aside title="Merge: false" type="caution">
  With the `merge` parameter set to `false`, the entire data object is replaced. Be sure to include all required fields:
</Aside>
```ts
// Replace entire data object (no merge)
this.app.data.set(
  {
    score: 0,
    settings: {
      soundEnabled: true,
      musicVolume: 1.0,
    },
  },
  false, // do not merge
);
````

## get() Method

The `get()` method retrieves data from storage:

```ts
// Get entire data object
const allData = this.app.data.get();

// Get specific field
const score = this.app.data.get('score');
const settings = this.app.data.get('settings');
```

## clear() Method

The `clear()` method removes data both from memory and localStorage:

```ts
// Clear all data
this.app.data.clear();

// Clear specific field
this.app.data.clear('score');
```

## Change Signal

All data modifications emit change events that you can listen to:

```ts
this.app.data.onDataChange.add((detail) => {
  const { key, value, restore } = detail;

  // Single key updates (from save())
  if (typeof key === 'string') {
    console.log(`${key} updated to:`, value);
  }

  // Multiple key updates (from set())
  if (Array.isArray(key)) {
    console.log('Updated keys:', key);
  }

  // Restoration from localStorage
  if (restore) {
    console.log('Data restored from localStorage');
  }
});
```
